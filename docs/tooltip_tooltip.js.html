<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: tooltip/tooltip.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: tooltip/tooltip.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @typedef {{ eventType: String, xOffset: Number, yOffset: Number, showCoordiantes: Boolean }} TooltipConfig */

export class Tooltip {

    /**
     * Creates an instance of Tooltip.
     * @param {HTMLElement} parentNode
     * @param {TooltipConfig} config
     * @memberof Tooltip
     */
    constructor(parentNode, config) {

        this.parentNode = parentNode;
        this.eventType = config.eventType || "mousemove";
        this.showLAU = config.LAU || false;
        this.showEPSG = config.EPSG || false;
        this.showNUTS = config.NUTS || false;
        this.showCoordinates = config.showCoordiantes || false;
        this.xOffset = config.xOffset || 15;
        this.yOffset = config.yOffset || 15;
        this.tooltipTableRows = {}; // store table rows &lt;tr>
        this.tooltipNode = null; //HTMLElement

        this.appendTooltipContainer(this.parentNode);
    }

    /**
    * @description Appends tooltip container to the scene
    * @function appendTooltipContainer
    * @param {HTMLElement} parentNode node upon which the tooltip is appended
    */
    appendTooltipContainer(parentNode) {

        //inject tooltip HTML to DOM
        let tooltipTemplate = document.createRange()
            .createContextualFragment(`&lt;div id="gridviz-tooltip">
                &lt;div id="gridviz-labeltip">

                &lt;table>
                &lt;thead>&lt;/thead>
                &lt;tbody id="tooltipTableBody">

                &lt;/tbody>
                &lt;/table>
            
                &lt;/div>
            &lt;div id="gridviz-pointtip">&lt;/div>
            &lt;/div>`);
        parentNode.append(tooltipTemplate);

        this.tooltipTableBody = document.querySelector("#tooltipTableBody");
        this.tooltipNode = document.querySelector("#gridviz-tooltip");
        this.pointTipNode = document.querySelector("#gridviz-pointtip");

    }

    updateTooltip(cell, left, top, color) {
        //hide rows of fields that do not belong to this cell
        for (const row in this.tooltipTableRows) {
            if (!cell[row]) {
                this.tooltipTableRows[row].style.display = "none";
            } else {
                this.tooltipTableRows[row].style.display = "block";
            }
        }

        // add/update table rows for each cell field
        for (const field in cell) {
            if (field !== "color") {
                if (this.showCoordinates == false &amp;&amp; field == "x" || field == "y") {
                    continue; //dont update x/y
                } else {
                    if (!this.tooltipTableRows[field]) {
                        // add new row
                        this.appendRowToTooltip(field);
                        this.tooltipTableRows[field].innerHTML = `&lt;th>&lt;strong>${field}&lt;/strong>&lt;/th>&lt;th>${cell[field]}&lt;/th>`
                    } else if (this.tooltipTableRows[field]) {
                        //update existing row
                        this.tooltipTableRows[field].innerHTML = `&lt;th>&lt;strong>${field}&lt;/strong>&lt;/th>&lt;th>${cell[field]}&lt;/th>`
                    }
                }
            }
        }
        this.tooltipNode.style.left = (left + this.xOffset) + "px";
        this.tooltipNode.style.top = (top + this.yOffset) + "px";
        this.pointTipNode.style.background = color || 'none';
        this.ensureTooltipOnScreen();
    }

    appendRowToTooltip(field) {
        let row = document.createElement('tr');
        row.id = field + 'tip';
        this.tooltipTableBody.appendChild(row)
        this.tooltipTableRows[field] = row;
    }

    /**
    * @function hide
    * @description sets tooltip display to none
    */
    hide() {
        this.tooltipNode.style.display = "none";
    }

    /**
    * @function show
    * @description sets tooltip display to block
    */
    show() {
        this.tooltipNode.style.display = "block";
    }

    /**
    * @function ensureTooltipOnScreen
    * @description Prevents the tooltip from appearing off screen
    * 
    */
    ensureTooltipOnScreen() {
        //too far right
        if (this.tooltipNode.offsetLeft > this.parentNode.clientWidth - this.tooltipNode.clientWidth) {
            this.tooltipNode.style.left = this.tooltipNode.offsetLeft - (this.tooltipNode.clientWidth + this.xOffset * 2) + "px";

        }
        //too far down
        if (this.tooltipNode.offsetTop + this.tooltipNode.clientHeight > this.parentNode.clientHeight) {
            this.tooltipNode.style.top = this.tooltipNode.offsetTop - (this.tooltipNode.clientHeight + this.yOffset * 2) + "px";
        }
    }
}




// /**
// * @description Updates the innerHTML of the tooltip container
// * @function updateTooltip
// * @param {Object} app
// */
// export function updateTooltip(app) {
//     let x, y;
//     if (app._mobile) {
//         //mobile coords are scaled to [-1,1], so we invert them
//         x = Math.round(app.viewer.mobileCoordScale.invert(tooltip_state.x))
//         y = Math.round(app.viewer.mobileCoordScale.invert(tooltip_state.y))
//     } else {
//         x = tooltip_state.x;
//         y = tooltip_state.y;
//     }
//     if (app.zerosRemoved_) {
//         //add the zeros removed back on
//         let f = Number('1E' + app.zerosRemoved_);
//         x = Math.round(x * f);
//         y = Math.round(y * f);
//     }

//     // set tooltip position and display
//     tooltip.style.display = tooltip_state.display;
//     tooltip.style.left = tooltip_state.left + "px";
//     tooltip.style.top = tooltip_state.top + "px";
//     pointTip.style.background = tooltip_state.color;

//     // set tooltip attributes HTML
//     app._cellFields.forEach((field) => {
//         tooltipRows[field].innerHTML = `&lt;th>&lt;strong>${field}:&lt;/strong> &lt;/th>
//         &lt;th>${tooltip_state[field]}&lt;/th>`
//     })


//     if (this.showCoordinates) {
//         tooltipRows.x.innerHTML = `&lt;th>&lt;strong>x:&lt;/strong>&lt;/th>
//         &lt;th>${x}&lt;/th>`

//         tooltipRows.y.innerHTML = `&lt;th>&lt;strong>y:&lt;/strong>&lt;/th>
//         &lt;th>${y}&lt;/th>`
//     }

//     if (this.showEPSG) {
//         tooltipRows.crstip.innerHTML = `&lt;th>&lt;strong>CRS:&lt;/strong>&lt;/th>
//         &lt;th>EPSG:${app.EPSG_}&lt;/th>`
//     }

//     //fetch NUTS info using GISCO id REST API
//     if ([4326, 4258, 3035].includes(app.EPSG_)) {

//         let nutsRequest = `${CONSTANTS.nutsAPIBaseURL}nuts?x=${x}&amp;y=${y}&amp;proj=${app.EPSG_}&amp;year=2021&amp;level=3`;
//         let lauRequest = `${CONSTANTS.nutsAPIBaseURL}lau?x=${x}&amp;y=${y}&amp;proj=${app.EPSG_}&amp;year=2019&amp;level=3`;

//         //get both (promise.all required to ensure tooltip on screen after both requests have resolved)
//         if (this.showLAU &amp;&amp; this.showNUTS) {
//             let promises = [json(nutsRequest), json(lauRequest)];
//             Promise.all(promises).then((res) => {

//                 if (res[0]) {
//                     if (res[0].features.length > 0) {
//                         //add NUTS id to tooltip table
//                         let f = res[0].features[0];

//                         NUTSCodeTip.innerHTML = `
// &lt;th>&lt;strong>NUTS3 code:&lt;/strong>&lt;/th>
// &lt;th>${f.properties.nuts_id}&lt;/th>
// `;
//                     }
//                 }

//                 if (res[1]) {
//                     if (res[1].features.length > 0) {
//                         //add lau id and name to tooltip table
//                         let f = res[1].features[0];
//                         LAUCodeTip.innerHTML = `
//           &lt;th>&lt;strong>LAU code:&lt;/strong>&lt;/th>
//           &lt;th>${f.properties.lau_id}&lt;/th>
//           `;
//                         LAUNameTip.innerHTML = `
//           &lt;th>&lt;strong>LAU:&lt;/strong>&lt;/th>
//           &lt;th>${f.properties.lau_name}&lt;/th>
//           `;
//                     }
//                 }
//                 ensureTooltipOnScreen(app);
//             })

//         } else {
//             //get NUTS
//             if (this.showLAU) {

//                 json(nutsRequest).then(
//                     json => {
//                         if (json.features.length > 0) {
//                             //add NUTS id to tooltip table
//                             let f = json.features[0];

//                             NUTSCodeTip.innerHTML = `
//             &lt;th>&lt;strong>NUTS3 code:&lt;/strong>&lt;/th>
//             &lt;th>${f.properties.nuts_id}&lt;/th>
//             `;
//                         }
//                         ensureTooltipOnScreen(app);
//                     },
//                     err => {
//                         console.log("no LAU found");
//                         ensureTooltipOnScreen(app);
//                         //console.error(err);
//                     })
//             } else if (this.showNUTS) {

//                 json(lauRequest).then(
//                     json => {

//                         if (json.features.length > 0) {
//                             //add lau id and name to tooltip table
//                             let f = json.features[0];
//                             LAUCodeTip.innerHTML = `
//               &lt;th>&lt;strong>LAU code:&lt;/strong>&lt;/th>
//               &lt;th>${f.properties.lau_id}&lt;/th>
//               `;
//                             LAUNameTip.innerHTML = `
//               &lt;th>&lt;strong>LAU:&lt;/strong>&lt;/th>
//               &lt;th>${f.properties.lau_name}&lt;/th>
//               `;
//                         }
//                         ensureTooltipOnScreen(app);
//                     },
//                     err => {
//                         console.log("no NUTS found");
//                         ensureTooltipOnScreen(app);
//                         //console.error(err);
//                     })
//             } else {
//                 //dont need to wait for fetch
//                 ensureTooltipOnScreen(app);
//             }
//         }
//     }
// }




</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="App.html">App</a></li><li><a href="Dataset.html">Dataset</a></li><li><a href="GeoJsonLayer.html">GeoJsonLayer</a></li><li><a href="GeoJsonLayer.exports.GeoJsonLayer.html">exports.GeoJsonLayer</a></li><li><a href="LabelsLayer.html">LabelsLayer</a></li><li><a href="LabelsLayer.exports.LabelsLayer.html">exports.LabelsLayer</a></li><li><a href="Layer.html">Layer</a></li><li><a href="Legend.exports.Legend.html">exports.Legend</a></li><li><a href="Style.html">Style</a></li><li><a href="Tooltip.exports.Tooltip.html">exports.Tooltip</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addButtonEvents">addButtonEvents</a></li><li><a href="global.html#addEventListeners">addEventListeners</a></li><li><a href="global.html#addGeoJson">addGeoJson</a></li><li><a href="global.html#addMouseEventsToView">addMouseEventsToView</a></li><li><a href="global.html#addPlacenameFeaturesToViewer">addPlacenameFeaturesToViewer</a></li><li><a href="global.html#addResizeEvent">addResizeEvent</a></li><li><a href="global.html#animate">animate</a></li><li><a href="global.html#appendTooltipContainer">appendTooltipContainer</a></li><li><a href="global.html#build">build</a></li><li><a href="global.html#colorLegend">colorLegend</a></li><li><a href="global.html#createLineFromCoords">createLineFromCoords</a></li><li><a href="global.html#createPlacenameLabelObject">createPlacenameLabelObject</a></li><li><a href="global.html#defineDefaultPlacenameThresholds">defineDefaultPlacenameThresholds</a></li><li><a href="global.html#defineWhereParameter">defineWhereParameter</a></li><li><a href="global.html#ensureTooltipOnScreen">ensureTooltipOnScreen</a></li><li><a href="global.html#getPlacenames">getPlacenames</a></li><li><a href="global.html#getPopulationParameterFromScale">getPopulationParameterFromScale</a></li><li><a href="global.html#hide">hide</a></li><li><a href="global.html#loadNuts2json">loadNuts2json</a></li><li><a href="global.html#ramp">ramp</a></li><li><a href="global.html#removePlacenamesFromScene">removePlacenamesFromScene</a></li><li><a href="global.html#show">show</a></li><li><a href="global.html#thresholdLabels">thresholdLabels</a></li><li><a href="global.html#updateLegend">updateLegend</a></li><li><a href="global.html#updatePlacenameLabels">updatePlacenameLabels</a></li><li><a href="global.html#validateAppConfiguration">validateAppConfiguration</a></li><li><a href="global.html#viewWholeGrid">viewWholeGrid</a></li><li><a href="global.html#zoom">zoom</a></li><li><a href="global.html#zoomIn">zoomIn</a></li><li><a href="global.html#zoomOut">zoomOut</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Tue Dec 07 2021 14:07:07 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
