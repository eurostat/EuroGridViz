<!DOCTYPE html>
<html lang="en" style="height:100%;">

<head>
    <title></title>
</head>

<body style="margin: 0; height:100%; font-family: Arial, Helvetica, sans-serif; overflow: hidden;">
    <canvas id="vacanvas" style="height:100%; width:100%;"></canvas>

    <div
        style="position: absolute; left: 20px; top: 20px; width: auto; height: auto; padding: 10px; border: 0px; border-radius: 5px; background: #FFFFFFCC; line-height: 1.6; box-shadow: 5px 5px 5px grey">
        <span style="font-size: 17pt; font-weight: bold;">Statistical grids - Croatia</span><br><span
            style="font-size: 10pt;">
            <hr>
            <input type="checkbox" id="label" checked>
            <label for="label">City names</label>
            <input type="checkbox" id="boundary" checked>
            <label for="boundary">Boundaries</label>
            <hr>Source: Croatian Bureau of Statistics, 2015, <a href="https://podaci.dzs.hr/media/selhhzke/metod_74.pdf"
                target="_blank" rel="noopener noreferrer">URL</a>
        </span>
    </div>

    <script src="../build/gridvizc.js"></script>
    <script>

        //make application
        const app = new gviz.App()
            .setGeoCenter({ x: 4785299, y: 2540380 }).setZoomFactor(100).setZoomFactorExtent([10, 1500])
            .setLabelLayer(gviz.getEuronymeLabelLayer("HR", "20")).setBoundaryLayer(gviz.getEurostatBoundariesLayer())

        //test view from URL parameters, if any
        app.cg.setViewFromURL()


        //styles







        /*
        const sPopulationTotal = new gviz.ShapeColorSizeStyle({
            colorCol: "TOTAL",
            color: (v, r, s) => gviz.interpolateOrRd(gviz.s(v / s.max, 0.25)),
            shape: () => "square",
            zfStroke: 80,
        }).addLegend({ color: { id: "schgvvgolleggcend", bottom: "20px", left: "20px", title: "Number of inhabitants", ticks: 6, colorRamp: gviz.interpolateOrRd, fun: (t, r, s) => s.max * Math.pow(t, 1 / 0.25) } })


        const sPopulationTotalSide = new gviz.SideStyle({
            value: (c1, c2) => { return (c2 ? +c2["TOTAL"] : 0) - (c1 ? +c1["TOTAL"] : 0) },
            color: (side, r, s, z) => side.value > 0 && side.or === "h" || side.value < 0 && side.or === "v" ? "black" : "white",
            width: (side, r, s, z) => {
                const max = Math.max(Math.abs(s.min), Math.abs(s.max))
                return r * (0.02 + 0.4 * gviz.s(Math.abs(side.value) / max, 0.5))
            },
            //fillColor: "#fafafa",
        })
*/

        /*
        const sPopulationTotalSide = new gviz.SideStyle({
            value: (c1, c2) => { return (c2 ? +c2["TOTAL"] : 0) - (c1 ? +c1["TOTAL"] : 0) },
            color: (side, r, s, z) => "#000",
            width: (side, r, s, z) => {
                const max = Math.max(Math.abs(s.min), Math.abs(s.max))
                return r * (0.02 + 0.5 * gviz.s(Math.abs(side.value) / max, 0.7))
            },
        })*/




        const sPopulationMenWomen = new gviz.ShapeColorSizeStyle({
            colorCol: "DIFF_MEN_WOMEN",
            color: (v, r, s) => {
                const max = Math.max(Math.abs(s.min), Math.abs(s.max))
                const t = Math.sign(v) * gviz.s(Math.abs(v) / max, 0.2) / 2 + 0.5
                return gviz.interpolateSpectral(1 - t);
            },
            shape: () => "square",
            sizeCol: "TOTAL",
            size: (v, r, s, zf) => r * gviz.s(v / s.max, 0.2),
            zfStroke: 80,
        }).addLegend({
            color: {
                id: "scfolleggend", bottom: "20px", left: "20px", title: "Men / women difference", ticks: 7, colorRamp: gviz.interpolateSpectral, invert: true,
                fun: (t, r, s) => {
                    const max = Math.max(Math.abs(s.min), Math.abs(s.max))
                    return (t < 0.5 ? -1 : 1) * max * gviz.s(Math.abs(2 * t - 1), 1 / 0.2)
                }
            }
        })

        const col = gviz.interpolateSpectral;
        const sPopulationAge = new gviz.CompositionStyle({
            color: {
                "TOTAL_0_14": col(0.2),
                "TOTAL_15_64": col(0.4),
                "TOTAL_65p": col(0.9),
            },
            type: () => "flag",
            sizeCol: "TOTAL",
            size: (v, r, s, zf) => r * gviz.s(v / s.max, 0.1, 0),
            agePyramidHeight: (r) => 0.95 * r
        })//.addLegend({ colorCat: { id: "guyextscatlend534", bottom: "20px", left: "20px", shape: "square", colCat: [[col(0.2), "<= 14"], [col(0.4), "15 to 64"], [col(0.9), " > 65"]].reverse() } })


        const sPopulationEducation = new gviz.CompositionStyle({
            color: {
                "OTHER_EDUC": "gray",
                "TERTIARY_EDUCATION": col(0.9),
                "UPPER_SECONDARY_EDUCATION": col(0.4),
                "BASIC_EDUCATION_OR_LESS": col(0.2),
            },
            type: () => "ring",
            sizeCol: "TOTAL",
            size: (v, r, s, zf) => r * gviz.s(v / s.max, 0.1, 0),
            agePyramidHeight: (r) => 0.95 * r
        }).addLegend({
            colorCat: {
                id: "guyextlend533434", bottom: "20px", left: "20px", shape: "square",
                colCat: [[col(0.2), "basic or less"], [col(0.4), "secondary"], [col(0.9), "tertiary"], ["gray", "other"]].reverse()
            }
        })


        const sPopulationLabor = new gviz.CompositionStyle({
            color: {
                "OTHER_LABOR": "gray",
                "LABOUR_FORCE": col(0.2),
                "INACTIVE_POPULATION": col(0.9),
            },
            type: () => "flag",
            sizeCol: "TOTAL",
            size: (v, r, s, zf) => r * gviz.s(v / s.max, 0.1, 0),
            agePyramidHeight: (r) => 0.95 * r
        }).addLegend({
            colorCat: {
                id: "guyehvhgvxtscatlend534", bottom: "20px", left: "20px", shape: "square",
                colCat: [[col(0.9), "labour force"], [col(0.2), "inactive"], ["gray", "other"]].reverse()
            }
        })


        const sPopulationInact = new gviz.ShapeColorSizeStyle({
            colorCol: "INACT_RATE",
            color: (v, r, s) => gviz.interpolateOrRd(gviz.s(v / s.max, 1)),
            shape: () => "square",
            zfStroke: 80,
        }).addLegend({ color: { id: "schggozeDleggc45end", bottom: "20px", left: "20px", title: "Number of inhabitants", ticks: 6, colorRamp: gviz.interpolateOrRd, fun: (t, r, s) => s.max * Math.pow(t, 1 / 1) } })




        const sBusinessesSector = new gviz.CompositionStyle({
            color: {
                "s1": "#1b9e77",
                "s2": "#d95f02",
                "s3": "#7570b3",
            },
            type: () => "piechart",
            sizeCol: "TOTAL",
            size: (v, r, s, zf) => 1.25 * r * gviz.s(v / s.max, 0.1),
        }).addLegend({
            colorCat: {
                id: "guyehvhgvjhgxtscjhgatlend534", bottom: "20px", left: "20px", shape: "square",
                colCat: [["#1b9e77", "Primary"], ["#d95f02", "Secondary"], ["#7570b3", "Tertiary"]].reverse()
            }
        })




        // ESTABLISHMENTS - TOTAL
        // ACCOMMODATION UNITS (ROOMS APARTMENTS CAMPING SITES) - TOTAL
        // NUMBER OF PERMANENT BEDS
        const sTourismAccomod = new gviz.ShapeColorSizeStyle({
            colorCol: "NUMBER OF PERMANENT BEDS",
            color: (v, r, s) => gviz.interpolateOrRd(gviz.s(v / s.max, 0.2)),
            shape: () => "square",
            zfStroke: 80,
        }).addLegend({ color: { id: "scc1hgfggend", bottom: "20px", left: "20px", title: "Tourism accomodation", ticks: 6, colorRamp: gviz.interpolateOrRd, fun: (t, r, s) => s.max * Math.pow(t, 1 / 0.25) } })





        //const p = "A"
        const sTourismNat = new gviz.CompositionStyle({
            color: {
                "N_DOMESTIC TOURISTS - TOTAL": "cyan",
                "N_AUSTRIAN TOURISTS": "orange",
                "N_GERMAN TOURISTS": "red",
                "N_ITALIAN TOURISTS": "blue",
                "N_SLOVENIAN TOURISTS": "magenta",
                "N_OTHER": "gray",
            },
            type: () => "piechart",
            sizeCol: "TOTAL NIGHTS",
            size: (v, r, s, zf) => 1.25 * r * gviz.s(v / s.max, 0.1),
        }).addLegend({
            colorCat: {
                id: "guyeh35cgccjhgatlend534", bottom: "20px", left: "20px", shape: "square",
                colCat: [["cyan", "Croatian"], ["orange", "Austrian"], ["red", "German"], ["blue", "Italian"], ["magenta", "Slovenian"], ["gray", "Other"]].reverse()
            }
        })




        const ttfun = c => ""
        const url = "https://raw.githubusercontent.com/eurostat/gridviz/master/assets/csv/Croatia/";

        app.addCSVGridLayer(url + "Population_2011_Grid_1000m.csv", 1000, gviz.getTanakaStyle("TOTAL"), 0, 9999999999,
            //app.addCSVGridLayer(url + "Active_business_entities_2016_Grid_1000m.csv", 1000, [sBusinessesSector], 0, 9999999999,
            //app.addCSVGridLayer(url + "Tourism_2017_Grid_1000m.csv", 1000, [sTourismNat], 0, 9999999999,
            {
                preprocess: c => {
                    //parse position
                    //IDENTIFIER: "1kmN2621E4812"
                    let d = (c.IDENTIFIER + "").replace("1kmN", "").split("E")
                    c.y = (+d[0]) * 1000
                    c.x = (+d[1]) * 1000
                    delete c.IDENTIFIER

                    const overrideZ = (c, col) => c[col] = c[col] === "Z" ? 0 : +c[col]
                    const overrideD = (c, col) => c[col] = c[col] === "D" ? 0 : +c[col]

                    overrideD(c, "TOTAL")
                    c.DIFF_MEN_WOMEN = c.MEN - c.WOMEN
                    c.DIFF_MEN_WOMEN = 100 * c.DIFF_MEN_WOMEN / c.TOTAL
                    if (isNaN(c.DIFF_MEN_WOMEN)) c.DIFF_MEN_WOMEN = 0

                    //education
                    overrideD(c, "BASIC_EDUCATION_OR_LESS")
                    overrideD(c, "UPPER_SECONDARY_EDUCATION")
                    overrideD(c, "TERTIARY_EDUCATION")
                    c.OTHER_EDUC = c.TOTAL - c.BASIC_EDUCATION_OR_LESS - c.UPPER_SECONDARY_EDUCATION - c.TERTIARY_EDUCATION

                    //labor
                    overrideD(c, "INACTIVE_POPULATION")
                    overrideD(c, "LABOUR_FORCE")
                    c.OTHER_LABOR = c.TOTAL - c.INACTIVE_POPULATION - c.LABOUR_FORCE
                    //console.log(c.INACTIVE_POPULATION > c.LABOUR_FORCE)  // true and false
                    //console.log(c.OTHER_LABOR > 0) // true and false
                    //console.log(c.LABOUR_FORCE/c.INACTIVE_POPULATION <1)  // true and false
                    c.INACT_RATE = 100 * c.INACTIVE_POPULATION / c.TOTAL
                    if (isNaN(c.INACT_RATE)) c.INACT_RATE = 0
                    //console.log(c.INACT_RATE)


                    /*/TOTAL,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T
                    //see https://nacev2.com/fr
                    let sum = 0
                    for (let s of ["TOTAL", "A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T"]) {
                        c[s] = +c[s]
                        if (s != "TOTAL") sum += c[s]
                        if (isNaN(c[s])) console.log(c)
                    }
                    if (c.TOTAL != sum) console.log(c, c.TOTAL, sum)

                    c.s1 = c.A
                    c.s2 = c.B + c.C + c.D + c.E + c.F + c.G + c.H
                    c.s3 = c.I + c.J + c.K + c.L + c.M + c.N + c.O + c.P + c.Q + c.R + c.S + c.T
                    //console.log(c.s1, c.s2, c.s3)
                    //console.log(c.s1 + c.s2 + c.s3 == c.TOTAL)
                    */

                    /*
                                        for (let s of ["ESTABLISHMENTS - TOTAL", "ACCOMMODATION UNITS (ROOMS APARTMENTS CAMPING SITES) - TOTAL", "NUMBER OF PERMANENT BEDS"])
                                            overrideZ(c, s)
                                        for (let s of ["TOTAL ARRIVALS", "TOTAL NIGHTS"])
                                            overrideZ(c, s)
                                        for (let p of ["A", "N"]) {
                                            overrideZ(c, p + "_DOMESTIC TOURISTS - TOTAL")
                                            overrideZ(c, p + "_FOREIGN TOURISTS - TOTAL")
                                            for (let nat of ["AUSTRIAN", "GERMAN", "ITALIAN", "SLOVENIAN"])
                                                overrideZ(c, p + "_" + nat + " TOURISTS")
                                        }
                                        //console.log(c["TOTAL ARRIVALS"] == c["A_DOMESTIC TOURISTS - TOTAL"]+c["A_FOREIGN TOURISTS - TOTAL"]) true
                                        //console.log(c["TOTAL NIGHTS"] == c["N_DOMESTIC TOURISTS - TOTAL"]+c["N_FOREIGN TOURISTS - TOTAL"]) true
                    
                                        for (let p of ["A", "N"])
                                            c[p + "_OTHER"] = +c[p + "_FOREIGN TOURISTS - TOTAL"] - c[p + "_AUSTRIAN TOURISTS"] - c[p + "_GERMAN TOURISTS"] - c[p + "_ITALIAN TOURISTS"] - c[p + "_SLOVENIAN TOURISTS"]
                                        //console.log(c["A_OTHER"] >= 0, c["N_OTHER"] >= 0) true true
                    */

                }
            })



        // show/hide labels
        document.querySelector('#label').addEventListener('change', function () {
            app.showLabels = this.checked
            app.cg.redraw();
        });

        // show/hide boundaries
        document.querySelector('#boundary').addEventListener('change', function () {
            app.showBoundaries = this.checked
            app.cg.redraw();
        });

    </script>

    <div
        style="position: absolute; right: 0px; bottom: 0px; width: auto; height: auto; padding: 1px; border: 0px; background: #FFFFFFCC;">
        <span style="font-size: 8pt;"><a href="https://github.com/eurostat/gridviz"
                style="text-decoration:none">GridViz</a> |
            © <a href="https://eurogeographics.org" style="text-decoration:none">EuroGeographics</a></span>
    </div>

</body>

</html>