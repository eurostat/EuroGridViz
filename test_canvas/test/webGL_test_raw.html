<!DOCTYPE html>
<html lang="en" style="height:100%;">

<head>
    <title></title>
</head>

<body>
    <canvas id="canvas" width="800" height="500"></canvas>

    <script>

        const gl = document.getElementById("canvas").getContext("webgl")
        if (!gl) {
            alert("Unable to initialize WebGL. Your browser or machine may not support it.");
        }

        // Initialize a shader program, so WebGL knows how to draw our data
        function initShaderProgram(gl, ...shaders) {
            const program = gl.createProgram();
            for (const shader of shaders) gl.attachShader(program, shader);
            gl.linkProgram(program);
            if (gl.getProgramParameter(program, gl.LINK_STATUS)) return program;
            throw new Error(gl.getProgramInfoLog(program));
        }


        // creates a shader of the given type, uploads the source and compiles it.
        function createShader(gl, type, ...sources) {
            const shader = gl.createShader(type);
            gl.shaderSource(shader, sources.join("\n"));
            gl.compileShader(shader);
            if (gl.getShaderParameter(shader, gl.COMPILE_STATUS)) return shader;
            throw new Error(gl.getShaderInfoLog(shader));
        }



        //make program
        const p = initShaderProgram(
            gl,
            createShader(gl, gl.VERTEX_SHADER, `
            attribute vec4 pos;
            //uniform mat4 uModelViewMatrix;
            //uniform mat4 uProjectionMatrix;
            void main() {
              gl_Position = /*uProjectionMatrix **/ /**uModelViewMatrix **/ pos;
            }
          `),
            createShader(gl, gl.FRAGMENT_SHADER, `
            precision mediump float;
            uniform vec4 color;
            void main() {
                gl_FragColor = color;
            }`)
        );
        gl.useProgram(p);



        const drawRandomRect = function (program) {

            const nb = 100000
            const v = []
            for (let i = 0; i < nb; i++) {
                const x1 = 2 * Math.random() - 1
                const y1 = 2 * Math.random() - 1
                const x2 = x1 + 0.005
                const y2 = y1 + 0.01

                v.push(x1); v.push(y1)
                v.push(x2); v.push(y1)
                v.push(x1); v.push(y2)
                v.push(x2); v.push(y2)
            }

            //define input vertices
            const vertices = new Float32Array(v);

            const positionBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
            const position = gl.getAttribLocation(program, "pos");
            gl.vertexAttribPointer(
                position,
                2, //numComponents
                gl.FLOAT, //type
                false, //normalise
                0, //stride
                0 //offset
            );
            gl.enableVertexAttribArray(position);

            // Draw the scene
            //gl.clearColor(0.3, 0.3, 0.0, 1.0);
            //gl.clearDepth(1.0); // Clear everything
            //gl.enable(gl.DEPTH_TEST); // Enable depth testing
            //gl.depthFunc(gl.LEQUAL); // Near things obscure far things
            // Clear the canvas before we start drawing on it.
            //gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);

            for (let i = 0; i < v.length/8; i++) {
                gl.drawArrays(
                    gl.TRIANGLE_STRIP, // mode,see https://miro.medium.com/max/700/0*HQHB5lCGqlOUiysy.jpg
                    i * 8, // vertex list start
                    4 // vertex count
                );
            }


        }



        const setColor = function (program, r, g, b, a) {
            // Shader uniform variable for color (read-only)
            const color = gl.getUniformLocation(program, "color");

            // Set color        R  G  B  A
            gl.uniform4f(color, r, g, b, a);
        }




        setColor(p, 0.5, 0.3, 1, 1)
        drawRandomRect(p)

        //drawRect(p, 0, 0.1, 0.3, 0.3)
        /*for (let i = 0; i < 1000; i++) {
            //set random color
            setColor(p, Math.random(), Math.random(), Math.random(), 1)
            //random position
            const x1 = 2 * Math.random() - 1
            const y1 = 2 * Math.random() - 1
            drawRect(p, x1, y1, x1 + 0.01, y1 + 0.02)
        }*/




    </script>


</body>

</html>