<!DOCTYPE html>
<html lang="en" style="height: 100%">

<head>
    <meta name="viewport" content="maximum-scale=1.0, user-scalable=no" />
    <title>Gridviz - Shape/color/size style</title>
</head>

<body style="margin: 0; height: 100%; font-family: Arial, Helvetica, sans-serif; overflow: hidden">
    <div id="viz-container" style="height: 100%; width: 100%"></div>

    <script src="../../dist/gridviz.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-color@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-interpolate@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-scale-chromatic@3"></script>
    <script>
        let containerDiv = document.getElementById('viz-container')

        const map = new gridviz.Map(containerDiv, {
            transparentBackground: false,
            tooltip: {
                yMouseOffset: -5,
                xMouseOffset: -5,
            },
        })
            .setGeoCenter({ x: 3763437, y: 2891045 })
            .setBackgroundColor("black")
            .setZoom(50.1)
            .setZoomExtent([7, 2000])
            .addMultiScaleTiledGridLayer(
                [200, 400, 600, 1000, 2000, 5000, 10000, 20000, 50000, 100000],
                (r) =>
                    'https://raw.githubusercontent.com/jgaffuri/tiled-grid-france-filosofi/main/out/csv/met/ind/2019/' +
                    r +
                    'm/',
                [
                    new gridviz.NinjaStarStyle({
                        sizeCol: 'ind',
                        size: (v, r, s, z) => gridviz.sPow(v / s.max, 0.26),
                        colorCol: 'age_ratio',
                        color: (v, r, s) => d3.interpolateSpectral(1 - v),
                        shape: () => 'p',
                    }),
                ],
                {
                    minPixelsPerCell: 12,
                    preprocess: (c) => {
                        //<24
                        const yyy = +c.ind_0_3 + +c.ind_4_5 + +c.ind_6_10 + +c.ind_11_17 + +c.ind_18_24
                        //>65
                        const ooo = +c.ind_65_79 + +c.ind_80p
                        c.age_ratio = yyy + ooo == 0 ? 0 : (yyy - ooo) / (yyy + ooo)
                        c.age_ratio = c.age_ratio * 0.5 + 0.5
                    },
                }
            )

    </script>
</body>

</html>