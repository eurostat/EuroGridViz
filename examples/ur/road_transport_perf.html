<!DOCTYPE html>
<html lang="en" style="height:100%;">

<head>
    <title></title>
</head>

<body style="font-family: sans-serif;">
    <div id="vizRTP" style="position:relative; height:600px; width:900px;">
        <div
            style="position: absolute; right: 0px; bottom: 0px; width: auto; height: auto; padding: 1px; border: 0px; background: #FFFFFFCC;">
            <span style="font-size: 0.8em; font-family: sans-serif;"><a target="_blank"
                    rel="nofollow noreferrer noopener" href="https://github.com/eurostat/gridviz"
                    style="text-decoration:none">GridViz</a> |
                © <a target="_blank" rel="nofollow noreferrer noopener" href="https://eurogeographics.org"
                    style="text-decoration:none">EuroGeographics</a></span>
        </div>
        <div id="legendRTP"
            style="position: absolute; left: 5px; bottom: 5px; width: auto; height: auto; padding: 0px; border: 0px; border-radius: 5px; background: #FFFFFFDD; line-height: 1.6; box-shadow: 5px 5px 5px grey">
        </div>
    </div>

    <script src="../../dist/gridviz.js"></script>
    <script src="https://ec.europa.eu/assets/estat/E/E4/gisco/ure2023/d3-color.js"></script>
    <script src="https://ec.europa.eu/assets/estat/E/E4/gisco/ure2023/d3-interpolate.js"></script>
    <script src="https://ec.europa.eu/assets/estat/E/E4/gisco/ure2023/d3-scale-chromatic.js"></script>
    <script>
        const nuts2jsonURL = "https://raw.githubusercontent.com/eurostat/Nuts2json/master/pub/v2/" //"https://ec.europa.eu/assets/estat/E/E4/gisco/pub/nuts2json/v2/"
        const euronymURL = "https://raw.githubusercontent.com/eurostat/euronym/main/pub/v2/UTF/" //"https://ec.europa.eu/assets/estat/E/E4/gisco/pub/euronym/v2/UTF/"
        const tiledGridsURL = "https://raw.githubusercontent.com/jgaffuri/tiledgrids/main/data/europe/" //"https://ec.europa.eu/eurostat/cache/GISCO/urbanrural/grid_data/europe/"
        const bgLayerURL = "https://raw.githubusercontent.com/jgaffuri/mbxyz/main/pub/elevation_shading/" //"https://ec.europa.eu/eurostat/cache/GISCO/urbanrural/background/elevation_shading/"

        let containerDiv = document.getElementById("vizRTP");
        const app = new gviz.App(containerDiv, { legendDivId: "legendRTP" })
            .setGeoCenter({ x: 4313947, y: 2970049 }).setZoomFactor(2500).setZoomFactorExtent([40, 7500])
            .setLabelLayer(
                gviz.getEuronymeLabelLayer("EUR", 50, {
                    ccIn: ["AT", "BE", "BG", "CY", "CZ", "DE", "DK", "EE", "ES", "FI", "FR", "GR", "HR", "HU", "IE", "IT", "LT", "LU", "LV", "PL", "PT", "MT", "NL", "RO", "SE", "SK", "SI", "CH", "IS", "NO", "LI", "RS", "XK", "AL", "TR", "ME", "MK"],
                    baseURL: euronymURL,
                })
            )
            .setBoundaryLayer(gviz.getEurostatBoundariesLayer({
                baseURL: nuts2jsonURL,
            }))
            .addBackgroundLayer({
                url: bgLayerURL,
                resolutions: Array.from({ length: 9 }, (_, i) => 28.00132289714475 * Math.pow(2, 10 - i)),
                origin: [0, 6000000],
                filterColor: zf => "#ffffffc0",
            })

            .addMultiScaleTiledCSVGridLayer(
                [1000, 2000, 5000, 10000, 20000, 50000, 100000],
                r => tiledGridsURL + "road_transp_perf/" + r + "m/",
                [
                    new gviz.SquareColorWGLStyle({
                        colorCol: "rp", // pp ra rp
                        color: d3.interpolateGnBu,
                        tFun: (v, r, s) => Math.min(v, 100) / 100,
                        stretching: { fun: "expRev", alpha: 2 },
                    }),
                    new gviz.StrokeStyle({ strokeColorCol: "rp", strokeColor: v => +v ? "#666" : "", maxZoom: 100 })
                ],
                {
                    pixNb: 1,
                    cellInfoHTML: c => "<b>" + c.rp + "</b> road transport performance",
                    preprocess: (c) => c.rp != ""
                })

        //add legend
        app.layers[0].styles[0].legends.push(new gviz.ColorLegend({
            title: "Road transport performance",
            width: 200,
            ticks: 2,
            colorRamp: d3.interpolateGnBu,
            tickFormat: "text",
            fun: (t, r, s) => t == 0 ? "Low" : t == 1 ? "High" : "X",
        }))
        //new gviz.ColorLegend({ title: "Equilibre jeunes/âgés", ticks: 2, tickFormat: "text", colorRamp: d3.interpolateSpectral, fun: (t, r, s) => t == 0 ? "Plus jeunes" : t == 0.5 ? "équilibre" : "Plus âgés" })

    </script>

</body>

</html>