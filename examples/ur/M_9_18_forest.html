<!DOCTYPE html>
<html lang="en" style="height:100%;">

<head>
    <title></title>
</head>

<body style="font-family: sans-serif;">
    <h1>Map 9.18 - Forest</h1>

    <p>European forest - <a href="https://land.copernicus.eu/pan-european/high-resolution-layers/forests">Copernicus
            land monitoring service</a>.</p>

    <div id="vizAcc" style="position:relative; height:600px; width:900px;">

        <div
            style="font-size: 0.9em; position: absolute; left: 10px; top: 10px; width: auto; height: auto; padding: 5px; border: 0px; border-radius: 5px; background: #FFFFFFCC; line-height: 1.6; box-shadow: 3px 3px 3px grey">
            <input type="radio" name="style" id="c" value="c" checked>
            <label for="c">Combined</label>
            <br>
            <input type="radio" name="style" id="tcd" value="tcd">
            <label for="tcd">Tree cover density</label>
            <br>
            <input type="radio" name="style" id="dlt" value="dlt">
            <label for="dlt">Dominant leaf type</label>
        </div>
        <div
            style="position: absolute; right: 0px; bottom: 0px; width: auto; height: auto; padding: 1px; border: 0px; background: #FFFFFFCC;">
            <span style="font-size: 0.8em; font-family: sans-serif;"><a href="https://github.com/eurostat/gridviz"
                    style="text-decoration:none">GridViz</a> |
                © <a href="https://eurogeographics.org" style="text-decoration:none">EuroGeographics</a></span>
        </div>
    </div>
    <div id="legendAcc"></div>
    <div>
        Administrative boundaries: ©EuroGeographics ©UN-FAO ©Turkstat
        <br>
        The designations employed and the presentation of material on this map do not imply the expression of any
        opinion whatsoever on the part of the European Union concerning the legal status of any country, territory, city
        or area or of its authorities, or concerning the delimitation of its frontiers or boundaries.
    </div>

    <script src="../../build/gridviz.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-color@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-interpolate@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-scale-chromatic@3"></script>
    <script>

        let containerDiv = document.getElementById("vizAcc");
        const app = new gviz.App(containerDiv, { legendDivId: "legendAcc" })
            .setGeoCenter({ x: 4313947, y: 2970049 }).setZoomFactor(2500).setZoomFactorExtent([50, 7500])
            .setLabelLayer(
                gviz.getEuronymeLabelLayer("EUR", 50, {
                    ccIn: ["AT", "BE", "BG", "CY", "CZ", "DE", "DK", "EE", "ES", "FI", "FR", "GR", "HR", "HU", "IE", "IT", "LT", "LU", "LV", "PL", "PT", "MT", "NL", "RO", "SE", "SK", "SI", "CH", "IS", "NO", "LI", "RS", "XK", "AL", "TR", "ME", "MK"]
                })
            ).setBoundaryLayer(gviz.getEurostatBoundariesLayer())

            .addMultiScaleTiledCSVGridLayer(
                [/*100, 200, 500,*/ 1000, 2000, 5000, 10000, 20000, 50000, 100000],
                r => "https://raw.githubusercontent.com/eurostat/gridviz/master/assets/csv/Europe/forest/tiled/" + r + "m/",
                [
                ],
                {
                    cellInfoHTML: c => {
                        let st = "Tree cover density: <b>" + c.tcd + "%</b>"
                        if (c.dlt == "1") st += "<br>Mainly broadleaved trees"
                        if (c.dlt == "2") st += "<br>Mainly coniferous trees"
                        return st;
                    },
                })

            //OSMCartoV4Composite GreyEarth CitiesRoadsRiversLakes Hypsometric BlueMarble NaturalEarth
            .addBackgroundLayer({
                url: "https://gisco-services.ec.europa.eu/maps/tiles/GreyEarth/EPSG3035/",
                resolutions: [156543.03392804097, 78271.51696402048, 39135.75848201024, 19567.87924100512, 9783.93962050256, 4891.96981025128, 2445.98490512564],
                origin: [0, 6000000],
                filterColor: zf => "#ffeeff88",
            })

        //DLT legend
        const dltLeg = new gviz.ColorCategoryLegend({
            title: "Dominant leaf tree", colCat: [
                ["#c6df58", "None"],
                ["#9fd045", "Mainly broadleaved"],
                ["#38a43b", "Mainly coniferous"],
            ],
            shape: "square",
        })

        //
        const update = () => {

            //get style selection
            const style = document.querySelector('input[name="style"]:checked').value

            const lay = app.layers[0]

            if (style == "c") {

                //set style
                lay.styles = [
                    new gviz.ShapeColorSizeStyle({
                        sizeCol: "tcd",
                        size: (v, r, s, zf) => 1.2 * r * Math.sqrt(v / 100),
                        colorCol: "dlt",
                        color: (v) => {
                            //none
                            if (v == 0) return "#c6df58";
                            //coniferous
                            if (v == 2) return "#38a43b";
                            //broad
                            return "#9fd045";
                        },
                        shape: () => "circle",
                    }),
                    new gviz.StrokeStyle({
                        sizeCol: "tcd",
                        size: (v, r, s, zf) => 1.2 * r * Math.sqrt(v / 100),
                        strokeColor: () => "#006600",
                        strokeWidth: (v, r, s, z) => 0.3 * z,
                        shape: () => "circle"
                    })
                ]
                lay.pixNb = 6

                //set legend
                lay.styles[0].legends = [dltLeg, new gviz.SizeLegend({ shape: "circle", labelUnitText: "% tree cover density", fillColor: "#666d" })]

            } else if (style == "tcd") {

                //set style
                lay.styles = [
                    new gviz.SquareColorWGLStyle({
                        colorCol: "tcd",
                        color: (t) => d3.interpolateBuGn(0.2 + 0.8 * t),
                        tFun: (v) => v / 100
                    }),
                    new gviz.StrokeStyle({ strokeColor: () => "#666", maxZoom: 100 })
                ]
                lay.pixNb = 1.5

                //set legend
                lay.styles[0].legends = [new gviz.ColorLegend({
                    title: "Tree cover density (%)",
                    width: 600,
                    ticks: 7,
                    colorRamp: (t) => d3.interpolateBuGn(0.2 + 0.8 * t),
                    fun: (t, r, s) => 100 * t,
                })]

            } else if (style == "dlt") {

                //set style
                lay.styles = [
                    new gviz.SquareColorWGLStyle({
                        colorCol: "dlt",
                        color: (t) => {
                            //none
                            if (t == 0) return "#c6df58";
                            //coniferous
                            if (t == 1) return "#38a43b";
                            //broad
                            return "#9fd045";
                        },
                    }),
                    new gviz.StrokeStyle({ strokeColor: () => "#666", maxZoom: 100 })
                ]
                lay.pixNb = 1.5

                //set legend
                lay.styles[0].legends = [dltLeg]

            }

            //redraw
            app.cg.redraw();
        }

        //
        document.querySelector('#dlt').addEventListener('change', update)
        document.querySelector('#tcd').addEventListener('change', update)
        document.querySelector('#c').addEventListener('change', update)

        update();

    </script>

</body>

</html>