<!DOCTYPE html>
<html lang="en" style="height:100%;">

<head>
    <title></title>
</head>

<body style="font-family: sans-serif;">
    <h1>Map 9.18 - Forest</h1>

    <p>European forest - <a href="https://land.copernicus.eu/pan-european/high-resolution-layers/forests">Copernicus
            land monitoring service</a>.</p>

    <div id="vizAcc" style="position:relative; height:600px; width:900px;">

        <div
            style="font-size: 0.9em; position: absolute; left: 10px; top: 10px; width: auto; height: auto; padding: 5px; border: 0px; border-radius: 5px; background: #FFFFFFCC; line-height: 1.6; box-shadow: 3px 3px 3px grey">
            <input type="radio" name="style" id="c" value="c" checked>
            <label for="c">Combined</label>
            <br>
            <input type="radio" name="style" id="tcd" value="tcd">
            <label for="tcd">Tree cover density</label>
            <br>
            <input type="radio" name="style" id="dlt" value="dlt">
            <label for="dlt">Dominant leaf type</label>
        </div>

        <div
            style="position: absolute; right: 0px; bottom: 0px; width: auto; height: auto; padding: 1px; border: 0px; background: #FFFFFFCC;">
            <span style="font-size: 0.8em; font-family: sans-serif;"><a href="https://github.com/eurostat/gridviz"
                    style="text-decoration:none">GridViz</a> |
                Â© <a href="https://eurogeographics.org" style="text-decoration:none">EuroGeographics</a></span>
        </div>
    </div>
    <div id="legendAcc"></div>

    <script src="../../build/gridviz.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-color@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-interpolate@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-scale-chromatic@3"></script>
    <script>

        let containerDiv = document.getElementById("vizAcc");
        const app = new gviz.App(containerDiv, { legendDivId: "legendAcc" })
            .setGeoCenter({ x: 4313947, y: 2970049 }).setZoomFactor(2500).setZoomFactorExtent([50, 7500])
            .setLabelLayer(gviz.getEuronymeLabelLayer()).setBoundaryLayer(gviz.getEurostatBoundariesLayer())

            .addMultiScaleTiledCSVGridLayer(
                [/*100, 200, 500,*/ 1000, 2000, 5000, 10000, 20000, 50000, 100000],
                r => "https://raw.githubusercontent.com/eurostat/gridviz/master/assets/csv/Europe/forest/tiled/" + r + "m/",
                [
                ],
                {
                    cellInfoHTML: c => {
                        let st = "Tree cover density: <b>" + c.tcd + "%</b>"
                        if (c.dlt == "1") st += "<br>Mainly broadleaved trees"
                        if (c.dlt == "2") st += "<br>Mainly coniferous trees"
                        return st;
                    },
                })

            //OSMCartoV4Composite GreyEarth CitiesRoadsRiversLakes Hypsometric BlueMarble NaturalEarth
            .addBackgroundLayer({
                url: "https://gisco-services.ec.europa.eu/maps/tiles/GreyEarth/EPSG3035/",
                resolutions: [156543.03392804097, 78271.51696402048, 39135.75848201024, 19567.87924100512, 9783.93962050256, 4891.96981025128, 2445.98490512564],
                origin: [0, 6000000],
                filterColor: zf => "#ffeeff88",
            })

        //DLT legend
        const catLeg = new gviz.ColorCategoryLegend({
            title: "Dominant leaf tree", colCat: [
                ["#ccf24d", "None"],
                ["#a6e64d", "Mainly broadleaved"],
                ["#00a600", "Mainly coniferous"],
            ],
            shape: "square",
        })


        //
        const update = () => {

            //get style selection
            const style = document.querySelector('input[name="style"]:checked').value

            const lay = app.layers[0]

            if (style == "c") {

                lay.styles = [
                    new gviz.ShapeColorSizeStyle({
                        sizeCol: "tcd",
                        size: (v, r, s, zf) => 1.2 * r * Math.sqrt(v / 100),
                        colorCol: "dlt",
                        color: (v) => {
                            if (v == 0) return "#ccf24d";
                            if (v == 2) return "#00a600";
                            return "#a6e64d";
                        },
                        shape: () => "circle",
                    })
                ]
                lay.pixNb = 4.5

                lay.styles[0].legends = [catLeg]

            } else if (style == "tcd") {

                lay.styles = [
                    new gviz.SquareColorWGLStyle({
                        colorCol: "tcd",
                        color: (t) => d3.interpolateBuGn(0.2 + 0.8 * t),
                        tFun: (v) => v / 100
                    })
                ]
                lay.pixNb = 1.5

            } else if (style == "dlt") {

                lay.styles = [
                    new gviz.SquareColorWGLStyle({
                        colorCol: "dlt",
                        color: (t) => {
                            if (t == 0) return "#ccf24d";
                            if (t == 1) return "#00a600";
                            return "#a6e64d";
                        },
                    })
                ]
                lay.pixNb = 1.5

                lay.styles[0].legends = [catLeg]

            }

            //redraw
            app.cg.redraw();
        }

        //
        document.querySelector('#dlt').addEventListener('change', update)
        document.querySelector('#tcd').addEventListener('change', update)
        document.querySelector('#c').addEventListener('change', update)

        update();

    </script>

</body>

</html>