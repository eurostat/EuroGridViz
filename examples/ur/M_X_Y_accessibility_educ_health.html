<!DOCTYPE html>
<html lang="en" style="height:100%;">

<head>
    <title></title>
</head>

<body style="font-family: sans-serif;">
    <h1>Map 1.4 - Accessibility to education and health services</h1>

    <div id="vizAcc" style="position:relative; height:600px; width:900px;">

        <div
            style="font-size: 0.9em; position: absolute; left: 10px; top: 10px; width: auto; height: auto; padding: 5px; border: 0px; border-radius: 5px; background: #FFFFFFCC; line-height: 1.6; box-shadow: 3px 3px 3px grey">
            <input type="radio" name="serv" id="health" value="health" checked>
            <label for="health">Health</label>
            <br>
            <input type="radio" name="serv" id="educ" value="educ">
            <label for="educ">Education</label>
        </div>

        <div
            style="position: absolute; right: 0px; bottom: 0px; width: auto; height: auto; padding: 1px; border: 0px; background: #FFFFFFCC;">
            <span style="font-size: 0.8em; font-family: sans-serif;"><a href="https://github.com/eurostat/gridviz"
                    style="text-decoration:none">GridViz</a> |
                Â© <a href="https://eurogeographics.org" style="text-decoration:none">EuroGeographics</a></span>
        </div>
    </div>
    <div id="legendAcc"></div>

    <script src="../../build/gridviz.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-color@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-interpolate@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-scale-chromatic@3"></script>
    <script>

        let containerDiv = document.getElementById("vizAcc");
        const app = new gviz.App(containerDiv, { legendDivId: "legendAcc" })
            .setGeoCenter({ x: 4313947, y: 2970049 }).setZoomFactor(2500).setZoomFactorExtent([40, 7500])
            .setLabelLayer(gviz.getEuronymeLabelLayer()).setBoundaryLayer(gviz.getEurostatBoundariesLayer())
            .addBackgroundLayer({
                url: "https://gisco-services.ec.europa.eu/maps/tiles/GreyEarth/EPSG3035/",
                resolutions: [156543.03392804097, 78271.51696402048, 39135.75848201024, 19567.87924100512, 9783.93962050256, 4891.96981025128, 2445.98490512564],
                origin: [0, 6000000],
                filterColor: zf => "#ffffffd3",
            })

        /*
                const popDataset = app.makeMultiScaleTiledCSVGridDataset(
                    [1000, 2000, 5000, 10000, 20000, 50000, 100000],
                    r => "https://raw.githubusercontent.com/eurostat/gridviz/master/assets/csv/Europe/grid_pop_tiled/" + Math.round(r / 1000) + "km/",
                    //r => "https://ec.europa.eu/assets/estat/E/E4/gisco/mapping/test/" + Math.round(r / 1000) + "km/",
                )
        */

        //
        const update = () => {

            //get service selection
            const service = document.querySelector('input[name="service"]:checked').value

            console.log(service)

            //remove layers
            app.layers = []

            if (service == "health") {
                /*/add layer
                app.addLayerFromDataset(
                    popDataset,
                    [
                        new gviz.SquareColorWGLStyle({
                            colorCol: year,
                            color: d3.interpolateOrRd,
                            stretching: { fun: "expRev", alpha: -7 }
                        }),
                        new gviz.StrokeStyle({ strokeColorCol: year, strokeColor: v => +v ? "#666" : "", maxZoom: 80 })
                    ],
                    {
                        pixNb: 2,
                        cellInfoHTML: c => +c[year] ? "<b>" + c[year] + "</b> inhabitant" + (+c[year] == 1 ? "" : "s") : undefined
                    })
*/
                    /*
                //add legend
                app.layers[0].styles[0].legends.push(new gviz.ColorLegend({
                    title: "Number of inhabitants",
                    width: 600,
                    ticks: 7,
                    colorRamp: d3.interpolateOrRd,
                    fun: (t, r, s) => s.max * gviz.sExpRevInverse(t, -7),
                }))
*/
            } else if (service == "educ") {

                /*/add layer
                app.addLayerFromDataset(
                    popDataset,
                    [
                        new gviz.PillarStyle({
                            heightCol: year,
                            //height: (v, r, s, z) => 15 * r * gviz.sPow(v / s.max, 0.7),
                            height: (v, r, s, z) => 10 * r * gviz.sExpRev(v / s.max, -5),
                            color: () => col + "aa",
                            simple: true,
                            viewHeightFactor: 1,
                        })
                    ],
                    {
                        pixNb: 6,
                        cellInfoHTML: c => +c[year] ? "<b>" + c[year] + "</b> inhabitant" + (+c[year] == 1 ? "" : "s") : undefined
                    })
*/
            }

            //redraw
            app.cg.redraw();
        }

        //
        document.querySelector('#health').addEventListener('change', update)
        document.querySelector('#educ').addEventListener('change', update)

        //initialise
        update()

    </script>

</body>

</html>