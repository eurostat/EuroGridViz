<!DOCTYPE html>
<html lang="en" style="height: 100%">

<head>
    <meta name="viewport" content="maximum-scale=1.0, user-scalable=no" />
    <title>Gridviz - example</title>
</head>

<body style="margin: 0; height: 100%; font-family: Arial, Helvetica, sans-serif; overflow: hidden">
    <div id="viz-container" style="height: 100%; width: 100%"></div>

    <script src="../dist/gridviz.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gridviz-eurostat@1.0.0"></script>
    <script>
        let containerDiv = document.getElementById('viz-container')

        new gviz.App(containerDiv)
            .setGeoCenter({ x: 4500000, y: 2900000 })
            .setZoomFactor(1100)
            .setLabelLayer(gviz_es.getEuronymeLabelLayer('EUR', '20'))
            .setBoundaryLayer(gviz_es.getEurostatBoundariesLayer())
            .setViewFromURL()
            .addMultiScaleTiledGridLayer(
                [1000, 2000, 5000, 10000, 20000, 50000, 100000],
                (r) =>
                    'https://raw.githubusercontent.com/jgaffuri/tiledgrids/main/data/europe/bustat/' +
                    r +
                    'm/',
                [

                    //x,y,TOT_P_2021,agri,comm_serv,indus,res

                    new gviz.SquareColorWGLStyle({
                        colorCol: 'res',
                        tFun: (v, r, s) => gviz.sExpRev(v / s.max, -10),

                        //colorCol: 'habPer100m2',
                        //tFun: (value, resolution, stats) => gviz.sExp(value / stats.max, -500),

                        /*colorCol: 'resSurfPerHab',
                        tFun: (value, resolution, stats) => {
                            if (value == -999) return;
                            return gviz.sExp(value / stats.max, -25)
                        },*/
                    }),

                    /*new gviz.SquareColorCatWGLStyle({
                        colorCol: "valid",
                        color: { nonPopRes:"blue", "nonResPop": "red", ok: "lightgray" },
                    }),*/

                    /*
                    new gviz.ShapeColorSizeStyle({
                        //sizeCol: 'TOT_P_2021',
                        sizeCol: 'res',
                        size: (v, r, s, zf) => 1.4 * r * gviz.sPow(v / s.max, 0.13),
                        colorCol: 'valid',
                        color: (v, r, s) => v == "nonPopRes"? "blue" : v == "nonResPop"? "red" : "lightgray",
                        shape: () => 'circle',
                    }),*/
                ],
                {
                    preprocess: (c) => {
                        //TOT_P_2021	agri	comm_serv	indus	res
                        c.TOT_P_2021 = +c.TOT_P_2021; c.res = +c.res; c.agri = +c.agri; c.indus = +c.indus; c.comm_serv = +c.comm_serv;
                        c.bu = c.res + c.agri + c.indus + c.comm_serv
                        c.habPer100m2 = c.bu > 0 ? +c.TOT_P_2021 / c.bu : -999;
                        c.resSurfPerHab = c.TOT_P_2021 > 0 ? c.res / c.TOT_P_2021 : -999;
                        c.valid = c.TOT_P_2021 == 0 && c.res > 0 ? "nonPopRes" : c.TOT_P_2021 > 0 && c.res == 0 ? "nonResPop" : "ok";
                        //console.log(c)
                    },
                    pixNb: 3,
                }
            )
    </script>
</body>

</html>